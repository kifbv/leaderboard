## Codebase Patterns

**Prisma client import:** `import { prisma } from "../lib/prisma"` (relative from src/). The singleton is at `src/lib/prisma.ts`.
**Prisma model types:** `import type { Player } from "../generated/prisma/client"` (relative from src/).
**API routes:** Next.js App Router convention — `app/api/[route]/route.ts` with `export async function GET/POST(req)`.
**Prisma 7 seed config:** Seed command goes in `prisma.config.ts` under `migrations.seed`, NOT in `package.json`. Use `tsx prisma/seed.ts` with `tsx` installed as devDependency.
**Seed script pattern:** Import PrismaClient and adapter directly (not the lib/prisma singleton) — the singleton uses globalThis for hot-reload which doesn't apply in scripts.
**Tailwind v4:** CSS file uses `@import "tailwindcss"` (not the v3 directives). No `tailwind.config.ts` needed.
**ESLint immutability:** react-hooks/immutability rule flags `let` variable reassignment inside render scope. Use `reduce` instead of mutation inside `.map()` callbacks.
**Server components + data fetching:** Use `export const dynamic = "force-dynamic"` to prevent caching; query Prisma directly rather than making HTTP calls to API routes.

---

# Ralph Progress Log
Started: 2026-02-11
---

## 2026-02-11 - US-001
- Initialized Next.js 16 (App Router) with TypeScript and Tailwind CSS
- Installed Prisma 7 with SQLite via `@prisma/adapter-better-sqlite3` driver adapter
- Created schema: Player, Match, MatchPlayer models with initial migration
- Created `src/lib/prisma.ts` singleton using PrismaBetterSqlite3 adapter
- **Learnings for future iterations:**
  - Prisma 7 uses new `prisma-client` generator (not `prisma-client-js`), output goes to `src/generated/prisma/` with no index.ts — import from `../generated/prisma/client`
  - Prisma 7 requires a driver adapter for SQLite: `PrismaBetterSqlite3` from `@prisma/adapter-better-sqlite3`
  - `PrismaClientOptions` requires either `adapter` or `accelerateUrl` — no direct connection option
  - `@/*` path alias maps to project root (not `src/`), so use relative imports inside `src/`
  - DATABASE_URL is `file:./dev.db` (relative to project root); db file lives at project root
  - `create-next-app` can't run in a non-empty directory — create in temp dir and copy files over
---

## 2026-02-11 - US-002
- Created `prisma/seed.ts` with 6 players (varying ELO 998–1320, wins, losses)
- Installed `tsx` as devDependency for running TypeScript seed scripts
- Configured seed command in `prisma.config.ts` under `migrations.seed`
- Added `prisma.seed` key to `package.json` (informational only; Prisma 7 reads from config)
- Verified: `npx prisma db seed` works; idempotent via `upsert`
- Files changed: `prisma/seed.ts`, `prisma.config.ts`, `package.json`
- **Learnings for future iterations:**
  - Prisma 7 reads seed command from `prisma.config.ts` → `migrations.seed`, not `package.json`
  - Use `tsx` (not `ts-node`) for TypeScript seed scripts — simpler, works with ESM
  - Seed scripts should create their own PrismaClient (not import the Next.js singleton) to avoid globalThis issues
---

## 2026-02-11 - US-004
- Created `src/app/globals.css` with Tailwind v4 `@import "tailwindcss"` directive
- Created `src/app/layout.tsx` — app shell with nav bar (Leaderboard title + "Log Match" link)
- Created `src/app/page.tsx` — server component fetching players directly from Prisma, computing rank (ties share rank) and winRate, showing table with rank/name/ELO/W/L/Win%; empty state "No players yet"
- Files changed: `src/app/globals.css`, `src/app/layout.tsx`, `src/app/page.tsx`
- **Learnings for future iterations:**
  - Tailwind v4 uses `@import "tailwindcss"` in CSS (not `@tailwind base/components/utilities`)
  - ESLint react-hooks/immutability rule flags `let` reassignment inside render — use `reduce` instead of `let rank = 1` + `.map()` mutation
  - Next.js App Router server components should use `export const dynamic = "force-dynamic"` to opt out of caching when fetching data that changes per request
  - Server components can query Prisma directly — no need for an HTTP round-trip to the API route
---

## 2026-02-11 - US-003
- Created GET /api/leaderboard endpoint at `src/app/api/leaderboard/route.ts`
- Returns players sorted by eloRating desc with rank (ties share rank), winRate (computed, whole-number %)
- Files changed: `src/app/api/leaderboard/route.ts`, `prd.json`
- **Learnings for future iterations:**
  - Rank ties: track `rank` as a separate variable that only advances when eloRating changes from previous player
  - winRate = 0 when wins + losses = 0 (avoid division by zero); use `Math.round()` for whole-number percentage
  - Next.js App Router API routes live at `src/app/api/[path]/route.ts`; no layout.tsx required for API-only routes to typecheck
---
