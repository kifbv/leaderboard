{
  "name": "Ping Pong Leaderboard",
  "branchName": "ralph/design-alignment",
  "description": "Restyle all UI pages to match the design references in designs/. Dark mode, Lexend font, podium layout, card rows, modal-style log match, and consistent admin page.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Initialize Next.js project with Prisma and SQLite",
      "description": "As a developer, I want the Next.js project initialized with Prisma and SQLite so that all subsequent features have a working data layer.",
      "acceptanceCriteria": [
        "Next.js app created with TypeScript enabled",
        "Prisma configured with SQLite provider",
        "Player model exists with fields: id, name, eloRating (default 1000), wins (default 0), losses (default 0), createdAt",
        "Match model exists with type (SINGLES/DOUBLES), createdAt, and MatchPlayer join table relating players to matches with a role (e.g. winner/loser, team1/team2)",
        "npx prisma migrate dev runs without errors",
        "Typecheck passes"
      ],
      "category": "setup",
      "priority": 1,
      "passes": true,
      "dependsOn": [],
      "notes": "Design Match schema to support both singles (2 players) and doubles (4 players) via a MatchPlayer join table upfront."
    },
    {
      "id": "US-002",
      "title": "Create database seed script",
      "description": "As a developer, I want a seed script that populates the database with sample players so that the leaderboard can be visually verified during development.",
      "acceptanceCriteria": [
        "npx prisma db seed creates at least 5 players with varying ELO ratings, wins, and losses",
        "Seed script is idempotent (can be run multiple times without duplicating data)",
        "Seeded data produces a visually representative leaderboard",
        "Typecheck passes"
      ],
      "category": "setup",
      "priority": 2,
      "passes": true,
      "dependsOn": ["US-001"],
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Create leaderboard API endpoint",
      "description": "As a frontend consumer, I want a GET endpoint that returns all players sorted by ELO rating so that the leaderboard can be rendered.",
      "acceptanceCriteria": [
        "GET /api/leaderboard returns JSON array of players",
        "Players are sorted by eloRating descending",
        "Each player object includes: id, name, eloRating, wins, losses, winRate (calculated percentage)",
        "Response includes a rank field (1-indexed position); ties in ELO share the same rank",
        "Players with zero matches are included (winRate = 0)",
        "Typecheck passes"
      ],
      "category": "leaderboard",
      "priority": 3,
      "passes": true,
      "dependsOn": ["US-001"],
      "notes": "Win rate displayed as whole-number percentage. Rank is sequential starting at 1; ties share rank."
    },
    {
      "id": "US-004",
      "title": "Build leaderboard page",
      "description": "As an office worker, I want to see a ranked list of players with their stats on my phone so that I can check the standings at a glance.",
      "acceptanceCriteria": [
        "Landing page (/) displays a table/list of all players",
        "Each row shows: rank, player name, ELO rating, wins, losses, win rate %",
        "List is sorted by ELO rating (highest first)",
        "Mobile-first layout: readable without horizontal scrolling on a 375px-wide screen",
        "Empty state shown when no players exist ('No players yet')",
        "Typecheck passes",
        "Verify in browser"
      ],
      "category": "leaderboard",
      "priority": 4,
      "passes": true,
      "dependsOn": ["US-003"],
      "notes": "Use Next.js App Router with server components. Fetches data on each page load (no caching). Include a basic app layout shell with navigation link to the Log Match page (/log-match)."
    },
    {
      "id": "US-005",
      "title": "Create ELO calculation utility",
      "description": "As a developer, I want a pure function that computes new ELO ratings for two opponents so that match results produce correct ranking changes.",
      "acceptanceCriteria": [
        "Function accepts two current ratings and a result (who won) and returns both new ratings",
        "Uses standard ELO formula with K-factor of 32 and starting rating of 1000",
        "Unit tests cover: equal ratings, large rating gap (underdog wins), large rating gap (favorite wins)",
        "Ratings are rounded to the nearest integer",
        "Typecheck passes"
      ],
      "category": "match-recording",
      "priority": 5,
      "passes": true,
      "dependsOn": ["US-001"],
      "notes": "Pure function in lib/elo.ts. Formula: expectedScore = 1 / (1 + 10^((opponentRating - playerRating) / 400)), newRating = oldRating + K * (actualScore - expectedScore)"
    },
    {
      "id": "US-006",
      "title": "Create singles match recording API",
      "description": "As a frontend consumer, I want a POST endpoint that records a 1v1 match result and updates both players' ELO ratings in a single transaction.",
      "acceptanceCriteria": [
        "POST /api/matches accepts { type: 'SINGLES', winnerId: number, loserId: number }",
        "Endpoint validates that both player IDs exist and are different from each other",
        "Creates a Match record and updates both players' eloRating, wins, and losses in a single database transaction",
        "Returns the created match with the ELO changes (old and new ratings for each player)",
        "Returns 400 with a descriptive message for invalid input",
        "Typecheck passes"
      ],
      "category": "match-recording",
      "priority": 6,
      "passes": true,
      "dependsOn": ["US-005"],
      "notes": "All database mutations must use Prisma transactions for atomicity."
    },
    {
      "id": "US-007",
      "title": "Create doubles match recording API",
      "description": "As a frontend consumer, I want the POST endpoint to also handle 2v2 match results, updating ELO ratings for all four players.",
      "acceptanceCriteria": [
        "POST /api/matches accepts { type: 'DOUBLES', winnerTeam: [id, id], loserTeam: [id, id] }",
        "Endpoint validates all four player IDs exist and are all distinct",
        "For ELO calculation, uses the average rating of each team as the team's effective rating",
        "Each player on the winning team gains ELO; each player on the losing team loses ELO (same delta based on team averages)",
        "Creates a Match record and updates all four players in a single database transaction",
        "Returns 400 with a descriptive message for invalid input (duplicate players, missing players)",
        "Typecheck passes"
      ],
      "category": "match-recording",
      "priority": 7,
      "passes": true,
      "dependsOn": ["US-006"],
      "notes": "Extends the existing POST /api/matches endpoint. Team effective rating = average of two players' ratings."
    },
    {
      "id": "US-008",
      "title": "Build singles match logging UI",
      "description": "As an office worker, I want to pick two players and tap the winner to log a 1v1 match from my phone.",
      "acceptanceCriteria": [
        "A 'Log Match' page or modal is accessible from the main navigation",
        "User selects match type (Singles selected by default)",
        "Two player dropdowns allow selecting Player 1 and Player 2 from all registered players",
        "A player cannot be selected for both slots simultaneously",
        "Submit action is disabled until both players are selected",
        "User taps one of two clearly labeled buttons to indicate the winner",
        "On success, a confirmation is shown with the ELO changes (e.g., '+18 / -18')",
        "Form resets after successful submission so another match can be logged immediately",
        "Player dropdowns are sorted alphabetically by name",
        "Mobile-first layout: comfortably usable on a 375px-wide screen",
        "Typecheck passes",
        "Verify in browser"
      ],
      "category": "match-recording",
      "priority": 8,
      "passes": true,
      "dependsOn": ["US-004", "US-006"],
      "notes": "Needs navigation from leaderboard page."
    },
    {
      "id": "US-009",
      "title": "Build doubles match logging UI",
      "description": "As an office worker, I want to pick four players across two teams and tap the winning team to log a 2v2 match.",
      "acceptanceCriteria": [
        "When 'Doubles' match type is selected, the form shows Team 1 (two player selects) and Team 2 (two player selects)",
        "No player can appear in more than one slot",
        "User taps one of two buttons to indicate the winning team",
        "Submit action is disabled until all four players are selected",
        "On success, a confirmation is shown with each player's ELO change",
        "Form resets after successful submission so another match can be logged immediately",
        "Mobile-first layout: comfortably usable on a 375px-wide screen",
        "Typecheck passes",
        "Verify in browser"
      ],
      "category": "match-recording",
      "priority": 9,
      "passes": true,
      "dependsOn": ["US-007", "US-008"],
      "notes": "Extends the Log Match page with a Singles/Doubles toggle."
    },
    {
      "id": "US-010",
      "title": "Set up admin secret and environment config",
      "description": "As a developer, I want the app to use a secret URL segment for the admin page so that only people who know the link can access roster management.",
      "acceptanceCriteria": [
        "An environment variable ADMIN_SECRET holds the secret path segment",
        "A .env.example file documents this variable with a placeholder value",
        "The secret segment is at least 16 characters when set in .env",
        "If ADMIN_SECRET is not set, the admin routes return 404",
        "Typecheck passes"
      ],
      "category": "admin",
      "priority": 10,
      "passes": true,
      "dependsOn": ["US-001"],
      "notes": "Admin routes return 404 (not 403) for wrong secrets to avoid revealing the path exists."
    },
    {
      "id": "US-011",
      "title": "Create admin player API endpoints",
      "description": "As an admin page consumer, I want API endpoints to list all players and add new ones so that the roster can be managed.",
      "acceptanceCriteria": [
        "POST /api/admin/[secret]/players accepts { name: string }",
        "Returns 201 with the created player object (id, name, eloRating, wins, losses)",
        "Player is created with eloRating 1000, wins 0, losses 0",
        "Player names are trimmed of whitespace before saving",
        "Returns 400 if name is empty or only whitespace",
        "Returns 409 if a player with that exact name already exists (case-insensitive check)",
        "Returns 404 if the secret segment does not match ADMIN_SECRET",
        "GET /api/admin/[secret]/players returns JSON array of all players sorted alphabetically by name",
        "GET also returns 404 for wrong secret",
        "Typecheck passes"
      ],
      "category": "admin",
      "priority": 11,
      "passes": true,
      "dependsOn": ["US-010"],
      "notes": "Player names trimmed of whitespace before saving."
    },
    {
      "id": "US-012",
      "title": "Build admin roster management UI",
      "description": "As an office admin, I want a page at the secret URL where I can see all players and add new ones so that I can manage who's on the leaderboard.",
      "acceptanceCriteria": [
        "Page is accessible at /admin/[secret]",
        "Page displays a list of all current players (name and ELO rating)",
        "A text input and 'Add Player' button allow adding a new player by name",
        "On success, the new player appears in the list without a full page reload",
        "On error (duplicate name, empty name), a clear error message is shown",
        "Visiting /admin/wrong-secret shows a 404 page",
        "Mobile-first layout: usable on a 375px-wide screen",
        "Typecheck passes",
        "Verify in browser"
      ],
      "category": "admin",
      "priority": 12,
      "passes": true,
      "dependsOn": ["US-011"],
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Set up global dark theme with Lexend font and color tokens",
      "description": "As a user, I want the app to use a dark theme with Lexend font so that it matches the design mockups.",
      "acceptanceCriteria": [
        "Lexend and Material Symbols Outlined fonts are imported in globals.css",
        "Tailwind theme tokens defined: primary (#135bec), bg-dark (#0b121e), card-dark (#0d1625)",
        "layout.tsx uses dark mode class, Lexend font-family, dark background",
        "Old light-mode nav bar removed from layout (pages handle their own headers)",
        "max-w-md centered container wraps all content",
        "Typecheck passes"
      ],
      "category": "design-alignment",
      "priority": 13,
      "passes": false,
      "dependsOn": ["US-004"],
      "notes": "This is a styling-only change. No functionality changes. Ref: designs/global-leaderboard.html, designs/log-match-result.html"
    },
    {
      "id": "US-014",
      "title": "Restyle leaderboard — sticky header and floating action button",
      "description": "As a user, I want a sticky header with the app title and a floating 'Log Match' button so I can always navigate easily.",
      "acceptanceCriteria": [
        "Sticky header with blur backdrop at top of leaderboard page",
        "Header shows sports_tennis Material Symbol icon in primary color and 'TGSB Leaderboard' title",
        "No search bar (out of v1 scope)",
        "Floating 'Log Match' FAB button in bottom-right, primary color, rounded-full with shadow",
        "FAB links to /log-match",
        "Typecheck passes"
      ],
      "category": "design-alignment",
      "priority": 14,
      "passes": false,
      "dependsOn": ["US-013"],
      "notes": "Ref: designs/global-leaderboard.html. No bottom nav bar (out of scope)."
    },
    {
      "id": "US-015",
      "title": "Restyle leaderboard — top-3 podium layout",
      "description": "As a user, I want the top 3 players displayed in a podium layout so the leaders stand out visually.",
      "acceptanceCriteria": [
        "Top-3 players shown in podium: 2nd left, 1st center (raised), 3rd right",
        "1st place: larger circle (w-20 h-20), primary border with glow, '1st' badge in primary",
        "2nd place: medium circle (w-16 h-16), slate border, '2nd' badge",
        "3rd place: medium circle (w-16 h-16), bronze border (#b87333), '3rd' badge",
        "Initials circles with deterministic color (not avatar images)",
        "Each position shows: name (truncated), ELO in primary, 'XW - YL' subtitle",
        "Handles fewer than 3 players gracefully (hide empty podium slots)",
        "Typecheck passes"
      ],
      "category": "design-alignment",
      "priority": 15,
      "passes": false,
      "dependsOn": ["US-013"],
      "notes": "Ref: designs/global-leaderboard.html. Avatar images are out of v1 scope — use colored initials circles."
    },
    {
      "id": "US-016",
      "title": "Restyle leaderboard — card rows for 4th+ players",
      "description": "As a user, I want players ranked 4th and below shown in styled card rows so the leaderboard looks polished.",
      "acceptanceCriteria": [
        "HTML table removed, replaced with card-style rows",
        "Each card: rank number, initials avatar circle, player name, 'XW - YL · Z% Win' subtitle, ELO right-aligned in primary color",
        "Cards use bg-card-dark (#0d1625), rounded-2xl, hover state",
        "Empty state styled for dark mode",
        "Typecheck passes"
      ],
      "category": "design-alignment",
      "priority": 16,
      "passes": false,
      "dependsOn": ["US-015"],
      "notes": "Ref: designs/global-leaderboard.html"
    },
    {
      "id": "US-017",
      "title": "Restyle log match page — modal layout, header, and dark theme",
      "description": "As a user, I want the log match page styled as a modal-like screen with a close button so it feels like a focused action.",
      "acceptanceCriteria": [
        "Sticky header with close (X) button linking to /, centered 'Log Match' title",
        "Dark mode background consistent with design (#101622)",
        "Singles/Doubles toggle restyled for dark mode (primary active, slate inactive)",
        "Typecheck passes"
      ],
      "category": "design-alignment",
      "priority": 17,
      "passes": false,
      "dependsOn": ["US-013"],
      "notes": "Ref: designs/log-match-result.html. Set scores section is already replaced with winner selection."
    },
    {
      "id": "US-018",
      "title": "Restyle log match page — dropdowns and 'Who played?' section",
      "description": "As a user, I want styled player dropdowns with a clear 'Who played?' heading so the form is intuitive.",
      "acceptanceCriteria": [
        "'Who played?' centered heading with 'Select the match participants' subtitle",
        "2-column grid layout for Player 1 and Player 2 dropdowns (singles mode)",
        "Labels: uppercase, primary color, small tracking-widest text",
        "Select elements: dark bg, slate borders, rounded-xl, custom chevron, white text",
        "Typecheck passes"
      ],
      "category": "design-alignment",
      "priority": 18,
      "passes": false,
      "dependsOn": ["US-017"],
      "notes": "Ref: designs/log-match-result.html"
    },
    {
      "id": "US-019",
      "title": "Restyle log match page — winner buttons and feedback",
      "description": "As a user, I want winner selection buttons and result feedback styled for dark mode so the experience is cohesive.",
      "acceptanceCriteria": [
        "Winner selection buttons: primary color bg, rounded-xl, shadow, consistent with design aesthetic",
        "Success feedback: dark green-tinted background with green text",
        "Error feedback: dark red-tinted background with red text",
        "Typecheck passes"
      ],
      "category": "design-alignment",
      "priority": 19,
      "passes": false,
      "dependsOn": ["US-018"],
      "notes": "Ref: designs/log-match-result.html"
    },
    {
      "id": "US-020",
      "title": "Restyle admin page for dark mode consistency",
      "description": "As an admin, I want the roster management page to use dark mode styling consistent with the rest of the app.",
      "acceptanceCriteria": [
        "Form inputs: dark background, slate borders, white text",
        "Buttons: primary color styling",
        "Player list: card-dark background, slate dividers",
        "Labels and headings: white/slate text appropriate for dark mode",
        "Typecheck passes"
      ],
      "category": "design-alignment",
      "priority": 20,
      "passes": false,
      "dependsOn": ["US-013"],
      "notes": "No design reference for admin — just inherit global dark theme for consistency."
    },
    {
      "id": "US-021",
      "title": "Final QA — build, lint, typecheck, visual verification",
      "description": "As a developer, I want all validation checks to pass and the UI to look correct at 375px so the design alignment is complete.",
      "acceptanceCriteria": [
        "npx tsc --noEmit passes",
        "npm run build passes",
        "npm run lint passes",
        "Leaderboard page looks correct at 375px viewport",
        "Log Match page looks correct at 375px viewport",
        "Admin page looks correct at 375px viewport"
      ],
      "category": "design-alignment",
      "priority": 21,
      "passes": false,
      "dependsOn": ["US-016", "US-019", "US-020"],
      "notes": "Visual verification is manual — run dev server and check in browser."
    }
  ]
}
