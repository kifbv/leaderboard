{
  "name": "Ping Pong Leaderboard",
  "branchName": "ralph/design-alignment",
  "description": "Restyle all UI pages to match the design references in designs/. Dark mode, Lexend font, podium layout, card rows, modal-style log match, and consistent admin page.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Initialize Next.js project with Prisma and SQLite",
      "description": "As a developer, I want the Next.js project initialized with Prisma and SQLite so that all subsequent features have a working data layer.",
      "acceptanceCriteria": [
        "Next.js app created with TypeScript enabled",
        "Prisma configured with SQLite provider",
        "Player model exists with fields: id, name, eloRating (default 1000), wins (default 0), losses (default 0), createdAt",
        "Match model exists with type (SINGLES/DOUBLES), createdAt, and MatchPlayer join table relating players to matches with a role (e.g. winner/loser, team1/team2)",
        "npx prisma migrate dev runs without errors",
        "Typecheck passes"
      ],
      "category": "setup",
      "priority": 1,
      "passes": true,
      "dependsOn": [],
      "notes": "Design Match schema to support both singles (2 players) and doubles (4 players) via a MatchPlayer join table upfront."
    },
    {
      "id": "US-002",
      "title": "Create database seed script",
      "description": "As a developer, I want a seed script that populates the database with sample players so that the leaderboard can be visually verified during development.",
      "acceptanceCriteria": [
        "npx prisma db seed creates at least 5 players with varying ELO ratings, wins, and losses",
        "Seed script is idempotent (can be run multiple times without duplicating data)",
        "Seeded data produces a visually representative leaderboard",
        "Typecheck passes"
      ],
      "category": "setup",
      "priority": 2,
      "passes": true,
      "dependsOn": ["US-001"],
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Create leaderboard API endpoint",
      "description": "As a frontend consumer, I want a GET endpoint that returns all players sorted by ELO rating so that the leaderboard can be rendered.",
      "acceptanceCriteria": [
        "GET /api/leaderboard returns JSON array of players",
        "Players are sorted by eloRating descending",
        "Each player object includes: id, name, eloRating, wins, losses, winRate (calculated percentage)",
        "Response includes a rank field (1-indexed position); ties in ELO share the same rank",
        "Players with zero matches are included (winRate = 0)",
        "Typecheck passes"
      ],
      "category": "leaderboard",
      "priority": 3,
      "passes": true,
      "dependsOn": ["US-001"],
      "notes": "Win rate displayed as whole-number percentage. Rank is sequential starting at 1; ties share rank."
    },
    {
      "id": "US-004",
      "title": "Build leaderboard page",
      "description": "As an office worker, I want to see a ranked list of players with their stats on my phone so that I can check the standings at a glance.",
      "acceptanceCriteria": [
        "Landing page (/) displays a table/list of all players",
        "Each row shows: rank, player name, ELO rating, wins, losses, win rate %",
        "List is sorted by ELO rating (highest first)",
        "Mobile-first layout: readable without horizontal scrolling on a 375px-wide screen",
        "Empty state shown when no players exist ('No players yet')",
        "Typecheck passes",
        "Verify in browser"
      ],
      "category": "leaderboard",
      "priority": 4,
      "passes": true,
      "dependsOn": ["US-003"],
      "notes": "Use Next.js App Router with server components. Fetches data on each page load (no caching). Include a basic app layout shell with navigation link to the Log Match page (/log-match)."
    },
    {
      "id": "US-005",
      "title": "Create ELO calculation utility",
      "description": "As a developer, I want a pure function that computes new ELO ratings for two opponents so that match results produce correct ranking changes.",
      "acceptanceCriteria": [
        "Function accepts two current ratings and a result (who won) and returns both new ratings",
        "Uses standard ELO formula with K-factor of 32 and starting rating of 1000",
        "Unit tests cover: equal ratings, large rating gap (underdog wins), large rating gap (favorite wins)",
        "Ratings are rounded to the nearest integer",
        "Typecheck passes"
      ],
      "category": "match-recording",
      "priority": 5,
      "passes": true,
      "dependsOn": ["US-001"],
      "notes": "Pure function in lib/elo.ts. Formula: expectedScore = 1 / (1 + 10^((opponentRating - playerRating) / 400)), newRating = oldRating + K * (actualScore - expectedScore)"
    },
    {
      "id": "US-006",
      "title": "Create singles match recording API",
      "description": "As a frontend consumer, I want a POST endpoint that records a 1v1 match result and updates both players' ELO ratings in a single transaction.",
      "acceptanceCriteria": [
        "POST /api/matches accepts { type: 'SINGLES', winnerId: number, loserId: number }",
        "Endpoint validates that both player IDs exist and are different from each other",
        "Creates a Match record and updates both players' eloRating, wins, and losses in a single database transaction",
        "Returns the created match with the ELO changes (old and new ratings for each player)",
        "Returns 400 with a descriptive message for invalid input",
        "Typecheck passes"
      ],
      "category": "match-recording",
      "priority": 6,
      "passes": true,
      "dependsOn": ["US-005"],
      "notes": "All database mutations must use Prisma transactions for atomicity."
    },
    {
      "id": "US-007",
      "title": "Create doubles match recording API",
      "description": "As a frontend consumer, I want the POST endpoint to also handle 2v2 match results, updating ELO ratings for all four players.",
      "acceptanceCriteria": [
        "POST /api/matches accepts { type: 'DOUBLES', winnerTeam: [id, id], loserTeam: [id, id] }",
        "Endpoint validates all four player IDs exist and are all distinct",
        "For ELO calculation, uses the average rating of each team as the team's effective rating",
        "Each player on the winning team gains ELO; each player on the losing team loses ELO (same delta based on team averages)",
        "Creates a Match record and updates all four players in a single database transaction",
        "Returns 400 with a descriptive message for invalid input (duplicate players, missing players)",
        "Typecheck passes"
      ],
      "category": "match-recording",
      "priority": 7,
      "passes": true,
      "dependsOn": ["US-006"],
      "notes": "Extends the existing POST /api/matches endpoint. Team effective rating = average of two players' ratings."
    },
    {
      "id": "US-008",
      "title": "Build singles match logging UI",
      "description": "As an office worker, I want to pick two players and tap the winner to log a 1v1 match from my phone.",
      "acceptanceCriteria": [
        "A 'Log Match' page or modal is accessible from the main navigation",
        "User selects match type (Singles selected by default)",
        "Two player dropdowns allow selecting Player 1 and Player 2 from all registered players",
        "A player cannot be selected for both slots simultaneously",
        "Submit action is disabled until both players are selected",
        "User taps one of two clearly labeled buttons to indicate the winner",
        "On success, a confirmation is shown with the ELO changes (e.g., '+18 / -18')",
        "Form resets after successful submission so another match can be logged immediately",
        "Player dropdowns are sorted alphabetically by name",
        "Mobile-first layout: comfortably usable on a 375px-wide screen",
        "Typecheck passes",
        "Verify in browser"
      ],
      "category": "match-recording",
      "priority": 8,
      "passes": true,
      "dependsOn": ["US-004", "US-006"],
      "notes": "Needs navigation from leaderboard page."
    },
    {
      "id": "US-009",
      "title": "Build doubles match logging UI",
      "description": "As an office worker, I want to pick four players across two teams and tap the winning team to log a 2v2 match.",
      "acceptanceCriteria": [
        "When 'Doubles' match type is selected, the form shows Team 1 (two player selects) and Team 2 (two player selects)",
        "No player can appear in more than one slot",
        "User taps one of two buttons to indicate the winning team",
        "Submit action is disabled until all four players are selected",
        "On success, a confirmation is shown with each player's ELO change",
        "Form resets after successful submission so another match can be logged immediately",
        "Mobile-first layout: comfortably usable on a 375px-wide screen",
        "Typecheck passes",
        "Verify in browser"
      ],
      "category": "match-recording",
      "priority": 9,
      "passes": true,
      "dependsOn": ["US-007", "US-008"],
      "notes": "Extends the Log Match page with a Singles/Doubles toggle."
    },
    {
      "id": "US-010",
      "title": "Set up admin secret and environment config",
      "description": "As a developer, I want the app to use a secret URL segment for the admin page so that only people who know the link can access roster management.",
      "acceptanceCriteria": [
        "An environment variable ADMIN_SECRET holds the secret path segment",
        "A .env.example file documents this variable with a placeholder value",
        "The secret segment is at least 16 characters when set in .env",
        "If ADMIN_SECRET is not set, the admin routes return 404",
        "Typecheck passes"
      ],
      "category": "admin",
      "priority": 10,
      "passes": true,
      "dependsOn": ["US-001"],
      "notes": "Admin routes return 404 (not 403) for wrong secrets to avoid revealing the path exists."
    },
    {
      "id": "US-011",
      "title": "Create admin player API endpoints",
      "description": "As an admin page consumer, I want API endpoints to list all players and add new ones so that the roster can be managed.",
      "acceptanceCriteria": [
        "POST /api/admin/[secret]/players accepts { name: string }",
        "Returns 201 with the created player object (id, name, eloRating, wins, losses)",
        "Player is created with eloRating 1000, wins 0, losses 0",
        "Player names are trimmed of whitespace before saving",
        "Returns 400 if name is empty or only whitespace",
        "Returns 409 if a player with that exact name already exists (case-insensitive check)",
        "Returns 404 if the secret segment does not match ADMIN_SECRET",
        "GET /api/admin/[secret]/players returns JSON array of all players sorted alphabetically by name",
        "GET also returns 404 for wrong secret",
        "Typecheck passes"
      ],
      "category": "admin",
      "priority": 11,
      "passes": true,
      "dependsOn": ["US-010"],
      "notes": "Player names trimmed of whitespace before saving."
    },
    {
      "id": "US-012",
      "title": "Build admin roster management UI",
      "description": "As an office admin, I want a page at the secret URL where I can see all players and add new ones so that I can manage who's on the leaderboard.",
      "acceptanceCriteria": [
        "Page is accessible at /admin/[secret]",
        "Page displays a list of all current players (name and ELO rating)",
        "A text input and 'Add Player' button allow adding a new player by name",
        "On success, the new player appears in the list without a full page reload",
        "On error (duplicate name, empty name), a clear error message is shown",
        "Visiting /admin/wrong-secret shows a 404 page",
        "Mobile-first layout: usable on a 375px-wide screen",
        "Typecheck passes",
        "Verify in browser"
      ],
      "category": "admin",
      "priority": 12,
      "passes": true,
      "dependsOn": ["US-011"],
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Set up global dark theme with Lexend font and color tokens",
      "description": "As a user, I want the app to use a dark theme with Lexend font so that it matches the design mockups.",
      "acceptanceCriteria": [
        "Lexend and Material Symbols Outlined fonts imported via @import url() in globals.css",
        "Tailwind v4 @theme block in globals.css defines: --color-primary (#135bec), --color-background-dark (#0b121e), --color-card-dark (#0d1625), --color-background-light (#f6f6f8)",
        "Body base style sets font-family: Lexend in globals.css",
        "layout.tsx <html> has className='dark', <body> uses bg-background-dark text-white",
        "Old light-mode <nav> bar removed from layout.tsx (pages handle their own headers)",
        "Children wrapped in max-w-md mx-auto container for mobile-first centering",
        "npx tsc --noEmit passes"
      ],
      "category": "design-alignment",
      "priority": 13,
      "passes": true,
      "dependsOn": ["US-004"],
      "notes": "Styling-only. Tailwind v4 uses @theme {} in CSS, not tailwind.config.js. Files: src/app/globals.css, src/app/layout.tsx. Ref: designs/global-leaderboard.html, designs/log-match-result.html"
    },
    {
      "id": "US-014",
      "title": "Restyle leaderboard — sticky header and floating action button",
      "description": "As a user, I want a sticky header with the app title and a floating 'Log Match' button so I can always navigate easily.",
      "acceptanceCriteria": [
        "Sticky header: sticky top-0 z-30 bg-background-dark/80 backdrop-blur-lg px-6 pt-10 pb-4",
        "Header content: sports_tennis Material Symbol icon (text-primary text-4xl) + 'TGSB Leaderboard' h1 (text-2xl font-bold)",
        "No search bar (out of v1 scope)",
        "Floating 'Log Match' FAB: fixed bottom-8 right-6, bg-primary text-white rounded-full, shadow-[0_8px_30px_rgb(19,91,236,0.4)]",
        "FAB is an <a> linking to /log-match",
        "No bottom nav bar (out of v1 scope)",
        "npx tsc --noEmit passes"
      ],
      "category": "design-alignment",
      "priority": 14,
      "passes": true,
      "dependsOn": ["US-013"],
      "notes": "File: src/app/page.tsx. Replace existing <h1>Standings</h1> with sticky header. Ref: designs/global-leaderboard.html"
    },
    {
      "id": "US-015",
      "title": "Restyle leaderboard — top-3 podium layout",
      "description": "As a user, I want the top 3 players displayed in a podium layout so the leaders stand out visually.",
      "acceptanceCriteria": [
        "Top-3 players shown in podium: flex row with items-end, order: 2nd left, 1st center (raised -mt-4), 3rd right",
        "1st place: w-20 h-20 circle, border-4 border-primary, shadow glow, '1st' badge in primary bg, name text-sm, ELO text-lg",
        "2nd place: w-16 h-16 circle, border-2 border-slate-700, '2nd' badge in slate-600 bg, name text-xs, ELO text-sm",
        "3rd place: w-16 h-16 circle, border-2 border-[#b87333]/50, '3rd' badge in [#b87333]/80 bg",
        "Avatar circles show first letter of player name with deterministic background color",
        "Each position: name (truncated max-w-[80-100px]), ELO in text-primary, 'XW - YL' in text-slate-500 uppercase",
        "If fewer than 3 players, only show available positions; if 0-1 players skip podium",
        "npx tsc --noEmit passes"
      ],
      "category": "design-alignment",
      "priority": 15,
      "passes": true,
      "dependsOn": ["US-013"],
      "notes": "File: src/app/page.tsx. Use initials circles (not images). Ref: designs/global-leaderboard.html"
    },
    {
      "id": "US-016",
      "title": "Restyle leaderboard — card rows for 4th+ players",
      "description": "As a user, I want players ranked 4th and below shown in styled card rows so the leaderboard looks polished.",
      "acceptanceCriteria": [
        "Existing <table> markup removed, replaced with div-based card rows",
        "Each card: flex items-center gap-4 bg-card-dark p-4 rounded-2xl hover:bg-slate-800/40 transition-all",
        "Card content: rank (w-4 text-sm font-bold text-slate-400) | initials avatar (w-12 h-12 rounded-full) | name + subtitle (flex-1) | ELO (text-lg font-bold text-primary)",
        "Subtitle: '{wins}W - {losses}L · {winRate}% Win' in text-[10px] text-slate-500 uppercase",
        "Empty state: text-slate-500 centered",
        "npx tsc --noEmit passes"
      ],
      "category": "design-alignment",
      "priority": 16,
      "passes": true,
      "dependsOn": ["US-015"],
      "notes": "File: src/app/page.tsx. Ref: designs/global-leaderboard.html"
    },
    {
      "id": "US-017",
      "title": "Restyle log match page — modal layout, header, and dark theme",
      "description": "As a user, I want the log match page styled as a modal-like screen with a close button so it feels like a focused action.",
      "acceptanceCriteria": [
        "Full-screen container: min-h-screen bg-background-dark flex flex-col",
        "Sticky header: 3-column layout with close (X) Material Symbol button left (links to /), 'Log Match' title center, empty spacer right",
        "Header: border-b border-slate-800, bg-background-dark/80 backdrop-blur-md",
        "Singles/Doubles toggle: active = bg-primary text-white, inactive = bg-slate-800 text-slate-400",
        "npx tsc --noEmit passes"
      ],
      "category": "design-alignment",
      "priority": 17,
      "passes": true,
      "dependsOn": ["US-013"],
      "notes": "Files: src/app/log-match/LogMatchForm.tsx, src/app/log-match/page.tsx. Ref: designs/log-match-result.html"
    },
    {
      "id": "US-018",
      "title": "Restyle log match page — dropdowns and 'Who played?' section",
      "description": "As a user, I want styled player dropdowns with a clear 'Who played?' heading so the form is intuitive.",
      "acceptanceCriteria": [
        "'Who played?' heading: text-2xl font-bold centered, with 'Select the match participants.' subtitle in text-slate-500 text-sm",
        "2-column grid (grid-cols-2 gap-4) for Player 1/Player 2 dropdowns in singles mode",
        "Labels: text-[10px] font-bold uppercase tracking-widest text-primary (e.g. 'PLAYER 1')",
        "Select elements: bg-slate-900 border border-slate-800 rounded-xl py-3 px-3 text-sm text-white, custom chevron via CSS background-image",
        "Doubles mode: similar grid with Team 1/Team 2 section headers in text-slate-400",
        "npx tsc --noEmit passes"
      ],
      "category": "design-alignment",
      "priority": 18,
      "passes": true,
      "dependsOn": ["US-017"],
      "notes": "File: src/app/log-match/LogMatchForm.tsx. Update PlayerSelect sub-component. Ref: designs/log-match-result.html"
    },
    {
      "id": "US-019",
      "title": "Restyle log match page — winner buttons and feedback",
      "description": "As a user, I want winner selection buttons and result feedback styled for dark mode so the experience is cohesive.",
      "acceptanceCriteria": [
        "Winner buttons: bg-primary hover:bg-primary/90 text-white font-bold py-4 rounded-2xl shadow-lg shadow-primary/20",
        "Disabled state: bg-slate-800 text-slate-500 cursor-not-allowed (replace bg-gray-300)",
        "Success feedback: bg-green-900/30 border border-green-800 rounded-xl, text-green-400",
        "Error feedback: bg-red-900/30 border border-red-800 rounded-xl, text-red-400",
        "Loading text: text-slate-400",
        "npx tsc --noEmit passes"
      ],
      "category": "design-alignment",
      "priority": 19,
      "passes": true,
      "dependsOn": ["US-018"],
      "notes": "File: src/app/log-match/LogMatchForm.tsx. Ref: designs/log-match-result.html"
    },
    {
      "id": "US-020",
      "title": "Restyle admin page for dark mode consistency",
      "description": "As an admin, I want the roster management page to use dark mode styling consistent with the rest of the app.",
      "acceptanceCriteria": [
        "Form input: bg-slate-900 border border-slate-800 text-white rounded-xl focus:ring-2 focus:ring-primary/50",
        "Add button: bg-primary text-white hover:bg-primary/90 rounded-xl",
        "Player list: bg-card-dark rounded-2xl, divide-slate-800, white player names, text-slate-400 ELO",
        "Headings: white text (inherits from body)",
        "Error msg: text-red-400, Success msg: text-green-400",
        "Empty state: text-slate-500",
        "npx tsc --noEmit passes"
      ],
      "category": "design-alignment",
      "priority": 20,
      "passes": false,
      "dependsOn": ["US-013"],
      "notes": "File: src/app/admin/[secret]/AdminRosterForm.tsx. No design reference — inherit global dark theme."
    },
    {
      "id": "US-021",
      "title": "Final QA — build, lint, typecheck, visual verification",
      "description": "As a developer, I want all validation checks to pass and the UI to look correct at 375px so the design alignment is complete.",
      "acceptanceCriteria": [
        "npx tsc --noEmit passes",
        "npm run build passes",
        "npm run lint passes",
        "Leaderboard page matches design at 375px viewport",
        "Log Match page matches design at 375px viewport",
        "Admin page uses consistent dark mode at 375px viewport"
      ],
      "category": "design-alignment",
      "priority": 21,
      "passes": false,
      "dependsOn": ["US-016", "US-019", "US-020"],
      "notes": "Visual verification is manual — run dev server and check in browser."
    }
  ]
}
